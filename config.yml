variables: private/variables.yml

web_server:
  run_v2: true
  port: '{? port ?}'

templates:
  main:
    include: [private/transmission.yml]
    regexp:
      reject:
        - \btrailer\b: {from: title}
    content_filter:
      require:
        - '*.avi'
        - '*.mkv'
        - '*.mp4'
        - '*.r0*'
        - '*.rar'
      reject:
        - 'password.txt'
        - '*.wmv'
        - '*CD1*'
    # The Pirate Bay ssl certs always fail
    # verify_ssl_certificates: yes
    # Size and seed restrictions require real torrents
    magnets: no
    download: yes

  tv:
    include: [private/tvrss.yml]
    thetvdb_lookup: yes
    if:
      - tvdb_ep_air_date and tvdb_ep_air_date <= now - timedelta(days=2): accept
    set:
      label: tv
      path: /volume1/Media/Videos/To.Watch/TV/{{series_name.replace(' ', '.')}}/
      specials: no
      propers: yes
      ratio: 3.0

  tvBest:
    configure_series:
      settings:
        target: 1080p hdtv+
        quality: <=1080p
        timeframe: 30 minutes
      from:
        trakt_list:
          username: lvleph
          account: lvleph
          list: TV Best
          type: shows

  tvBetter:
    configure_series:
      settings:
        target: <=720p webrip+
        quality: <=720p
        timeframe: 30 minutes
      from:
        trakt_list:
          username: lvleph
          account: lvleph
          list: TV Better
          type: shows

  tvAVG:
    configure_series:
      settings:
        target: <=720p preair+
        quality: <=720p
        timeframe: 30 minutes
      from:
        trakt_list:
          username: lvleph
          account: lvleph
          list: TV Average
          type: shows

  movies:
    proper_movies: yes
    include: [private/moviesrss.yml]
    exists_movie:
      - /volume1/Media/Videos/
      - /volume1/Media/Videos/To.Watch/Movies/
    content_size:
      max: 5000
      strict: yes
    set:
      quality: dvdscr+
      target: 720p ac3+
      label: Movies
      path: /volume1/Media/Videos/To.Watch/Movies/
      temp: /volume1/Media/Downloads/

  movies-private:
    include: [private/moviesrss.yml]
    set:
      ratio: 3.0

  movies-keep:
    set:
      label: keep
      quality: 1080p

  movies-watch:
    set:
      label: watch
      quality: r5+

tasks:
  TVBest:
    template:
      - main
      - tv
      - tvBest

  TVBetter:
    template:
      - main
      - tv
      - tvBetter

  TVAVG:
    template:
      - main
      - tv
      - tvAVG

  MoviesKeep:
    template:
      - main
      - movies
      - movies-keep
    list_match:
      from:
        - movie_list: KEEPERS
      remove_on_match: yes

  MoviesWatch:
    template:
      - main
      - movies
      - movies-watch
    list_match:
      from:
        - movie_list: WATCH
      remove_on_match: yes

  MoviesWatchQueue:
    trakt_list:
      username: lvleph
      account: lvleph
      list: Keepers
      type: movies
    list_add:
      - movie_list: KEEPERS
    accept_all: yes

  MoviesKeepQueue:
    trakt_list:
      username: lvleph
      account: lvleph
      list: watchlist
      type: movies
    list_add:
      - movie_list: WATCH
    accept_all: yes

  RemoveTrakt:
    filesystem: 
      path:
        - /volume1/Media/Videos/Movies
        - /volume1/Media/Videos/To.Watch/Movies
      recursive: yes
      retrieve: files
      regexp: '^.*[^sample].*\.(avi|mp4,mkv,m4v)$'
    imdb_lookup: yes
    accept_all: yes
    list_remove:
      - trakt_list:
          username: lvleph
          account: lvleph
          list: Keepers
          type: movies
      - trakt_list:
          username: lvleph
          account: lvleph
          list: watchlist
          type: movies
      - movie_list: WATCH
      - movie_list: KEEPERS

schedules:
  - tasks: [TVBest, TVBetter, TVAVG]
    interval:
      minutes: 15
  - tasks: [MoviesWatch, MoviesKeep]
    interval:
      minutes: 60
  - tasks: [MoviesKeepQueue, MoviesWatchQueue]
    interval:
      hours: 24
  - tasks: RemoveTrakt
    interval:
      weeks: 4
